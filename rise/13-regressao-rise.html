
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Análise de regressão &#8212; Introdução à Ciência de Dados</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.acff12b8f9c144ce68a297486a2fa670.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe,.cell"
        const thebe_selector_input = "pre,.cell_input div.highlight"
        const thebe_selector_output = ".output,.cell_output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Introdução à Ciência de Dados</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../ipynb/00-conteudo.html">
   Apresentação do curso
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Parte 1
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../ipynb/01-introducao.html">
   Introdução à Ciência de Dados
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ipynb/02a-pip-venv.html">
   Pacotes e ambientes virtuais com
   <em>
    pip
   </em>
   e
   <em>
    venv
   </em>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ipynb/02b-conda.html">
   <em>
    Crash course
   </em>
   de
   <em>
    conda
   </em>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ipynb/03-ides.html">
   Ambientes de desenvolvimento e computação interativa
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ipynb/04-cvs-git.html">
   Controle de versão
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Parte 2
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../ipynb/05-python-intermediario.html">
   Python intermediário - I
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ipynb/06-python-intermediario-2.html">
   Python intermediário - II
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ipynb/07-python-intermediario-3.html">
   Python intermediário - III
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ipynb/08a-computacao-vetorizada.html">
   Computação vetorizada
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ipynb/08b-alc.html">
   Álgebra Linear Computacional básica
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ipynb/09-plotagem-matplotlib.html">
   Plotagem e formatação de gráficos
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Parte 3
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../ipynb/10a-pandas-series.html">
   Manipulação de dados - I
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ipynb/10b-pandas-dataframe.html">
   Manipulação de dados - II
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ipynb/10c-pandas-agrupamento.html">
   Manipulação de dados - III
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Parte 4
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../ipynb/11-estatistica-descritiva.html">
   Estatística Descritiva
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ipynb/12-correlacao.html">
   Correlação
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ipynb/13-regressao.html">
   Análise de regressão
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ipynb/13a-distribuicoes.html">
   Distribuições
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Parte 5
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../ipynb/14-aprendizado-maquina.html">
   Aprendizado de máquina - I
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ipynb/14b-aprendizado-maquina-2.html">
   Aprendizado de máquina - II
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ipynb/15-otimizacao.html">
   Otimização
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Parte 6
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../ipynb/16-visualizacao-dados-seaborn.html">
   Visualização de dados com
   <em>
    seaborn
   </em>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ipynb/17-raspagem-dados.html">
   Raspagem de dados
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ipynb/19-etica-dados.html">
   Ciência de dados e ética
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Questionários
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../ipynb/Q21.html">
   Questionário 21 (Q21)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ipynb/Q22.html">
   Questionário 22 (Q22)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ipynb/Q23.html">
   Questionário 23 (Q23)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ipynb/Q24.html">
   Questionário 24 (Q24)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ipynb/Q25.html">
   Questionário 25 (Q25)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ipynb/Q31.html">
   Questionário 31 (Q31)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ipynb/Q32.html">
   Questionário 32 (Q32)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ipynb/Q41.html">
   Questionário 41 (Q41)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ipynb/Q42.html">
   Questionário 42 (Q42)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ipynb/Q43.html">
   Questionário 43 (Q43)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ipynb/Q44.html">
   Questionário Q44
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ipynb/Q51.html">
   Questionário 51 (Q51)
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Cadernos de ICD
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../ipynb/cadernos-icd.html">
   Cadernos de ICD
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/rise/13-regressao-rise.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/gcpeixoto/ICD/master?urlpath=lab/tree/rise/13-regressao-rise.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/gcpeixoto/ICD/blob/master/rise/13-regressao-rise.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        <button type="button" class="btn btn-secondary topbarbtn"
            onclick="initThebeSBT()" title="Launch Thebe" data-toggle="tooltip" data-placement="left"><i
                class="fas fa-play"></i><span style="margin-left: .4em;">Live Code</span></button>
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#regressao-linear">
   Regressão linear
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#regressao-linear-simples">
     Regressão linear simples
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#minimos-quadrados">
       Mínimos quadrados
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#estudo-de-caso-o-gelo-marinho-e-as-mudancas-climaticas">
   Estudo de caso: o gelo marinho e as mudanças climáticas
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#normalizacao-dos-dados">
     Normalização dos dados
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#regressao-sobre-dados-normalizados">
     Regressão sobre dados normalizados
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#analise-quantitativa">
     Análise quantitativa
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#scipy-stats-linregress">
       <code class="docutils literal notranslate">
        <span class="pre">
         scipy.stats.linregress
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#sklearn-linear-model-linearregression">
       <code class="docutils literal notranslate">
        <span class="pre">
         sklearn.linear_model.LinearRegression
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#preditores-e-estimadores">
     Preditores e estimadores
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#regressao-multipla">
   Regressão múltipla
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#estimando-valores">
     Estimando valores
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#inspecao-de-multicolinearidade">
   Inspeção de multicolinearidade
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pandas-plotting-scatter-matrix">
     <code class="docutils literal notranslate">
      <span class="pre">
       pandas.plotting.scatter_matrix
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#seaborn-pairplot">
     <code class="docutils literal notranslate">
      <span class="pre">
       seaborn.pairplot
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#seaborn-heatmap">
     <code class="docutils literal notranslate">
      <span class="pre">
       seaborn.heatmap
      </span>
     </code>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercicio-aplicado">
   Exercício aplicado
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <section id="analise-de-regressao">
<h1>Análise de regressão<a class="headerlink" href="#analise-de-regressao" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p><em>Análise de regressão</em>, ou simplesmente <em>regressão</em>, busca saber de que maneira uma variável pode predizer o comportamento da outra.</p></li>
<li><p>Algumas perguntas do mundo real:</p>
<ul>
<li><p>Como o volume de vendas de canetas esferográficas muda se o preço da unidade subir?</p></li>
<li><p>De que maneira a taxa de inflação deste ano pode predizer o aumento do aluguel para os próximos dois meses?</p></li>
<li><p>A que horas seria melhor sair da universidade para evitar ficar preso pelo tráfego intenso na via?</p></li>
</ul>
</li>
</ul>
<ul class="simple">
<li><p>Perguntas como essas exigem uma <em>resposta</em> que pode ser expressa como uma combinação de uma ou mais <em>variáveis independentes</em> (<em>preditores</em>, ou <em>covariantes</em>).</p></li>
<li><p>Objetivo da análise de regressão: <em>construir modelos preditivos a partir dos dados</em>.</p></li>
</ul>
<blockquote>
<div><p>A origem do nome <em>regressão</em> deve-se ao estatístico inglês do século XIX Sir Francis Galton. Galton usou o termo para interpretar resultados de um experimento sobre hereditariedade, para o qual coletou alturas de pais e filhos para realizar predições sobre alturas das próximas gerações. Percebendo que a altura de um filho “regredia” (era menor do que) em relação à altura de seus pais por um fator de 2/3, publicou um artigo intitulado <em>Regression towards Mediocrity in Hereditary Stature</em> que, ironicamente, deu surgimento ao nome que usamos para o método estatístico que estamos aprendendo. Galton não aplicou o <em>método dos mínimos quadrados</em> (que é a base teórica para a regressão linear), já conhecido há 80 anos antes de sua época por Gauss e Legendre. Ele simplesmente “traçou uma reta”. Para Galton, a “regressão” representava apenas uma tendência de os dados “reverterem” a tendência média. Isto é, a origem do método <em>regressão</em> é uma “ironia do destino”.</p>
</div></blockquote>
<section id="regressao-linear">
<h2>Regressão linear<a class="headerlink" href="#regressao-linear" title="Permalink to this headline">¶</a></h2>
<p>Tenta ajustar um modelo matemático aos dados disponíveis cuja resposta <span class="math notranslate nohighlight">\({\bf y}\)</span> depende linearmente de até <span class="math notranslate nohighlight">\(d\)</span> preditores.</p>
<div class="math notranslate nohighlight">
\[{\bf y} = a_1{\bf x}_1 + a_2{\bf x}_2 + \ldots + a_d{\bf x}_d,\]</div>
<p><span class="math notranslate nohighlight">\(a_i \in \mathbb{R}, \, i = 1,\ldots d\)</span>, são os <em>parâmetros</em> ou <em>coeficientes</em> do modelo e os <span class="math notranslate nohighlight">\({\bf x}_i\)</span> as variáveis.</p>
<p>Como <em>sistema matricial</em>, assume a forma <span class="math notranslate nohighlight">\({\bf y} = {\bf X}{\bf a}\)</span>, onde</p>
<div class="math notranslate nohighlight">
\[\begin{split}{\bf y} = 
\begin{bmatrix}
y_1 \\
y_2 \\
\vdots \\
y_n \\
\end{bmatrix},
\quad
{\bf X} =
\begin{bmatrix}
x_{11} &amp; x_{12} &amp; \ldots &amp; x_{1d} \\
x_{21} &amp; x_{22} &amp; \ldots &amp; x_{2d} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
x_{n1} &amp; x_{n2} &amp; \ldots &amp; x_{nd}
\end{bmatrix},
\quad
{\bf a} = 
\begin{bmatrix}
a_1 \\
a_2 \\
\vdots \\
a_n \\
\end{bmatrix}.\end{split}\]</div>
<section id="regressao-linear-simples">
<h3>Regressão linear simples<a class="headerlink" href="#regressao-linear-simples" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>A <em>regressão linear simples</em> contém apenas um regressor e o modelo é a equação analítica de uma reta. Escrevemos</p></li>
</ul>
<div class="math notranslate nohighlight">
\[{\bf y} = a_0 + a_1{\bf x},\]</div>
<p>onde <span class="math notranslate nohighlight">\(a_0\)</span> é o <em>termo constante</em>, também chamado de <em>offset</em> ou <em>intercept</em>, e <span class="math notranslate nohighlight">\(a_1\)</span> é a <em>inclinação</em>.</p>
<ul class="simple">
<li><p>Quais seriam os valores de <span class="math notranslate nohighlight">\(a_0\)</span> e <span class="math notranslate nohighlight">\(a_1\)</span> que produziriam a melhor reta para os dados?</p>
<ul>
<li><p><em>Mínimos quadrados</em> (<em>least squares</em>).</p></li>
</ul>
</li>
</ul>
<section id="minimos-quadrados">
<h4>Mínimos quadrados<a class="headerlink" href="#minimos-quadrados" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Distância Euclidiana entre os valores preditos (modelados) e os valores disponíveis (conhecidos) deve ser <em>minimizada</em>.</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\|\bf{r}\|^2 =  \|\bf{y} - (a_0 + a_1\bf{x})\|^2 = \sum_{j=1}^{n}(y_j - a_0 - a_1x_j)^2,\]</div>
<ul class="simple">
<li><p>Problema é de otimização e equivale a buscar o ponto de mínimo global <span class="math notranslate nohighlight">\((a_0,a_1)\)</span> de uma função quadrática <span class="math notranslate nohighlight">\(F(x,y)\)</span>. Grosso modo, achar <span class="math notranslate nohighlight">\((a_0,a_1)\)</span>, tal que</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\frac{\partial F}{\partial a_0} = 0, \ \ \frac{\partial F}{\partial a_1} = 0.\]</div>
</section>
</section>
</section>
<section id="estudo-de-caso-o-gelo-marinho-e-as-mudancas-climaticas">
<h2>Estudo de caso: o gelo marinho e as mudanças climáticas<a class="headerlink" href="#estudo-de-caso-o-gelo-marinho-e-as-mudancas-climaticas" title="Permalink to this headline">¶</a></h2>
<p>Vamos entender a <em>análise de regressão</em> por meio de um estudo de caso. A pergunta que queremos responder é:</p>
<blockquote>
<div><p>A queda na área coberta por gelo no mar é causada pela alteração do clima?</p>
</div></blockquote>
<p>Vamos trabalhar com o <em>dataset</em> G02135 - Sea Ice Index, Version 3,
do <a class="reference external" href="https://nsidc.org/data/G02135/versions/3">NSIDC</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sb</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">sts</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sii</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../database/Sea_Ice_Index_Monthly_Baffin-Area-km^2.csv&#39;</span><span class="p">)</span>
<span class="n">month</span> <span class="o">=</span> <span class="s1">&#39;jan&#39;</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">sb</span><span class="o">.</span><span class="n">lmplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">month</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">sii</span><span class="p">,</span><span class="n">fit_reg</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
<span class="n">s</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Ice coverage area in Baffin Area [km2]&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/13-regressao-rise_9_0.png" src="../_images/13-regressao-rise_9_0.png" />
</div>
</div>
<p>Comentários:</p>
<ul class="simple">
<li><p>A função <code class="docutils literal notranslate"><span class="pre">lmplot()</span></code> realiza a análise de regressão simples com o modelo linear (reta) a partir dos dados passados.</p></li>
<li><p>O <em>dataset</em> em questão mostra que a área de cobertura do gelo na área de Baffin está sob uma tendência de declínio desde 1980.</p></li>
<li><p>A reta da regressão pode ser retirada do gráfico usando <code class="docutils literal notranslate"><span class="pre">fit_reg=False</span></code>.</p></li>
</ul>
<p>A seguir, “desdobramos” o <em>DataFrame</em> original para realizar uma análise de regressão durante os anos de 1997 a 2017 levando em conta valores mensais.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># intervalo de 20 anos</span>
<span class="n">siif</span> <span class="o">=</span> <span class="n">sii</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">1997</span><span class="p">:</span><span class="mi">2017</span><span class="p">]</span>

<span class="c1"># desdobra o DataFrame</span>
<span class="n">siif2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span><span class="s1">&#39;month&#39;</span><span class="p">,</span><span class="s1">&#39;area&#39;</span><span class="p">])</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">siif</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
    <span class="c1"># astype(&#39;float&#39;) necessário aqui, pois como &#39;Int64&#39; temos erro de SVD em lmplot</span>
    <span class="n">c1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="n">i</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>        
    <span class="n">c2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">13</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span> 
    <span class="n">c3</span> <span class="o">=</span> <span class="n">siif</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>      
    <span class="n">d</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;year&#39;</span><span class="p">:</span><span class="n">c1</span><span class="p">,</span><span class="s1">&#39;month&#39;</span><span class="p">:</span><span class="n">c2</span><span class="p">,</span><span class="s1">&#39;area&#39;</span><span class="p">:</span><span class="n">c3</span><span class="o">.</span><span class="n">values</span><span class="p">})</span>
    <span class="n">siif2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">siif2</span><span class="p">,</span><span class="n">d</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sb</span><span class="o">.</span><span class="n">lmplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;month&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;area&#39;</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">siif2</span><span class="p">)</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Ice coverage in Baffin Area: 1997-2017 [km2]&#39;</span><span class="p">);</span>    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/13-regressao-rise_13_0.png" src="../_images/13-regressao-rise_13_0.png" />
</div>
</div>
<p>Comentários:</p>
<ul class="simple">
<li><p>Pode se ver que ao longo do ano, a cobertura de gelo segue um padrão periódico. Todavia, a análise de regressão mostra que há uma tendência de declínio da cobertura.</p></li>
<li><p>A flutuação periódica é coerente com as estações do ano.</p></li>
<li><p>O declínio se verifica pela queda da amplitude do ciclo periódico.</p></li>
</ul>
<section id="normalizacao-dos-dados">
<h3>Normalização dos dados<a class="headerlink" href="#normalizacao-dos-dados" title="Permalink to this headline">¶</a></h3>
<p>Para evitar a flutuação, normalizaremos a área usando desvios em relação às médias mensais e o percentual relativo à média para o período de anos estudado. A expressão matemática é dada por</p>
<div class="math notranslate nohighlight">
\[\tilde{\bf a}_i = 100\frac{({\bf a}_i - \mu_i)}{\mu}, \ \ i = 1,\ldots, 12,\]</div>
<p>onde <span class="math notranslate nohighlight">\(\tilde{\bf a}_i\)</span> é a série contendo valores das áreas normalizadas, <span class="math notranslate nohighlight">\({\bf a}_i\)</span> a série contendo valores das áreas originais, <span class="math notranslate nohighlight">\(\mu_i\)</span> as médias, para o <span class="math notranslate nohighlight">\(i\)</span>-ésimo mês, e <span class="math notranslate nohighlight">\(\mu\)</span> é a média das áreas para todo o período de 20 anos (todos os meses).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span><span class="p">;</span> <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span> 

<span class="n">siif2</span><span class="p">[</span><span class="s1">&#39;arean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">siif2</span><span class="p">[</span><span class="s1">&#39;area&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">):</span>
    <span class="n">siif2</span><span class="o">.</span><span class="n">arean</span><span class="p">[</span><span class="n">siif2</span><span class="o">.</span><span class="n">month</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">siif2</span><span class="o">.</span><span class="n">arean</span><span class="p">[</span><span class="n">siif2</span><span class="o">.</span><span class="n">month</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> \
                                         <span class="n">siif2</span><span class="o">.</span><span class="n">arean</span><span class="p">[</span><span class="n">siif2</span><span class="o">.</span><span class="n">month</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> \
                                         <span class="o">/</span><span class="n">siif2</span><span class="o">.</span><span class="n">area</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Plotando os dados normalizados, vemos o seguinte gráfico.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sb</span><span class="o">.</span><span class="n">lmplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;month&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;arean&#39;</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">siif2</span><span class="p">)</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Normalized data&#39;</span><span class="p">);</span>    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/13-regressao-rise_18_0.png" src="../_images/13-regressao-rise_18_0.png" />
</div>
</div>
</section>
<section id="regressao-sobre-dados-normalizados">
<h3>Regressão sobre dados normalizados<a class="headerlink" href="#regressao-sobre-dados-normalizados" title="Permalink to this headline">¶</a></h3>
<p>Realizando uma nova análise de regressão para todo o período de 20 anos, com 95% de índice de confiança, visualizamos uma permanente tendência negativa.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># eixo x como &#39;float&#39; devido </span>
<span class="c1"># à incompatibilidade de lmplot com type &#39;Int64&#39;</span>
<span class="n">sb</span><span class="o">.</span><span class="n">lmplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;arean&#39;</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">siif2</span><span class="p">)</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Ice coverage decay: 1997-2017 [km2]&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/13-regressao-rise_20_0.png" src="../_images/13-regressao-rise_20_0.png" />
</div>
</div>
<blockquote>
<div><p>Conclusão do estudo: embora haja variações de ano a ano, nota-se uma tendência de queda na corbertura da área de gelo na área estudada. Esta diminuição da área de cobertura do gelo leva-nos a crer que o aquecimento global é a causa direta deste fenômeno.</p>
</div></blockquote>
</section>
<section id="analise-quantitativa">
<h3>Análise quantitativa<a class="headerlink" href="#analise-quantitativa" title="Permalink to this headline">¶</a></h3>
<p>No caso anterior, fizemos uma análise <em>qualitativa</em> (visual) de como a área de cobertura de gelo (resposta) diminuiu ao longo do ano (preditor). Entretanto, ainda não temos uma ideia <em>quantitativa</em> deste modelo. Para saber a equação da análise de regressão, podemos utilizar alguns métodos.</p>
<section id="scipy-stats-linregress">
<h4><code class="docutils literal notranslate"><span class="pre">scipy.stats.linregress</span></code><a class="headerlink" href="#scipy-stats-linregress" title="Permalink to this headline">¶</a></h4>
<p>A primeira forma que temos para encontrar a equação do modelo linear é usar <code class="docutils literal notranslate"><span class="pre">scipy.stats.linregress</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="n">sts</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">siif2</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">],</span><span class="n">siif2</span><span class="p">[</span><span class="s1">&#39;arean&#39;</span><span class="p">])</span>
 
<span class="c1"># inclinação, intercept, coef. de correlação</span>
<span class="n">m</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">rho</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">slope</span><span class="p">,</span><span class="n">res</span><span class="o">.</span><span class="n">intercept</span><span class="p">,</span><span class="n">res</span><span class="o">.</span><span class="n">rvalue</span>
<span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">rho</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(-0.051080057519927086, 102.51767544249365, -0.02247112769096617)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">siif2</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">],</span><span class="n">y</span><span class="o">=</span><span class="n">siif2</span><span class="p">[</span><span class="s1">&#39;arean&#39;</span><span class="p">])</span>

<span class="c1"># eq. da reta</span>
<span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">siif2</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">])</span>
<span class="n">yy</span> <span class="o">=</span> <span class="n">m</span><span class="o">*</span><span class="n">xx</span> <span class="o">+</span> <span class="n">b</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">,</span><span class="s1">&#39;r-&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;y=</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s1">x + </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">3</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/13-regressao-rise_25_0.png" src="../_images/13-regressao-rise_25_0.png" />
</div>
</div>
</section>
<section id="sklearn-linear-model-linearregression">
<h4><code class="docutils literal notranslate"><span class="pre">sklearn.linear_model.LinearRegression</span></code><a class="headerlink" href="#sklearn-linear-model-linearregression" title="Permalink to this headline">¶</a></h4>
<p>Outra forma é usar <code class="docutils literal notranslate"><span class="pre">sklearn.linear_model.LinearRegression</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>

<span class="c1"># modelo de ajuste</span>
<span class="n">lr</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">(</span><span class="n">fit_intercept</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># resolvendo (input deve ser array 2D)</span>
<span class="n">res2</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">siif2</span><span class="p">[[</span><span class="s1">&#39;year&#39;</span><span class="p">]],</span><span class="n">siif2</span><span class="p">[[</span><span class="s1">&#39;arean&#39;</span><span class="p">]])</span>

<span class="c1"># slope, intercept</span>
<span class="n">m2</span><span class="p">,</span><span class="n">b2</span> <span class="o">=</span> <span class="n">res2</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">res2</span><span class="o">.</span><span class="n">intercept_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">m2</span><span class="p">,</span><span class="n">b2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(-0.051080057519926975, 102.51767544249344)
</pre></div>
</div>
</div>
</div>
<p>Comentários:</p>
<ul class="simple">
<li><p>Verificamos que os valores de <em>slope</em> (coeficiente angular) e <em>intercept</em> (coeficiente linear) obtidos tanto por <code class="docutils literal notranslate"><span class="pre">sklearn.linear_model.LinearRegression</span></code> quanto por <code class="docutils literal notranslate"><span class="pre">scipy.stats.linregress</span></code> são equivalentes.</p></li>
</ul>
</section>
</section>
<section id="preditores-e-estimadores">
<h3>Preditores e estimadores<a class="headerlink" href="#preditores-e-estimadores" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Estimadores geram predições a partir da análise de regressão.</p></li>
<li><p><em>Métricas</em> populares:</p>
<ul>
<li><p><em>erro quadrático médio</em> (ou <em>MSE</em>, do inglês <em>mean squared error</em>), que fornece uma “média” do quadrado dos <span class="math notranslate nohighlight">\(n\)</span> erros existentes pontualmente entre a série de dados conhecidos <span class="math notranslate nohighlight">\(\{y_i\}\)</span> e a série de dados estimados <span class="math notranslate nohighlight">\(\{\hat{y}_i\}\)</span>. O MSE pode ser definido em termos de um <em>preditor</em> ou de um <em>estimador</em>. Ambos os conceitos são levemente distintos. Por conveniência de entendimento, vamos utilizar a definição do primeiro caso, que é:</p></li>
</ul>
</li>
</ul>
<div class="math notranslate nohighlight">
\[\text{MSE} = \frac{1}{n}\sum_{i=1}^n (y_i -\hat{y}_i)^2\]</div>
<ul class="simple">
<li><p><em>coeficiente de determinação</em>, que mede a “qualidade” do ajuste. Este coeficiente é simplesmente o quadrado do coeficiente de correlação. Comumente, ele é denotado por <span class="math notranslate nohighlight">\(R^2\)</span>. Mais comumente, adota-se que <span class="math notranslate nohighlight">\( 0 \leq R^2 \leq 1\)</span>. Todavia, dependendo de como ele for definido, valores negativos serão possíveis. Em suma, sua interpretação é a seguinte: se <span class="math notranslate nohighlight">\(R^2 = 0\)</span>, o ajuste é o pior possível; se <span class="math notranslate nohighlight">\(R^2 = 1\)</span>, o melhor possível.</p></li>
</ul>
<p>Vamos calcular essas métricas para um conjunto de dados do <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> sobre diabetes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">datasets</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># dataset &quot;diabetes&quot;</span>
<span class="n">diabetes_x</span><span class="p">,</span> <span class="n">diabetes_y</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">load_diabetes</span><span class="p">(</span><span class="n">return_X_y</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># usa apenas uma feature</span>
<span class="n">diabetes_x</span> <span class="o">=</span> <span class="n">diabetes_x</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>

<span class="c1"># separação dos dados entre &quot;treinamento&quot; e &quot;teste&quot;</span>
<span class="c1"># a predição ocorrerá para o conjunto de &quot;teste&quot;</span>

<span class="c1"># preditor</span>
<span class="n">diabetes_x_treino</span> <span class="o">=</span> <span class="n">diabetes_x</span><span class="p">[:</span><span class="o">-</span><span class="mi">20</span><span class="p">]</span> <span class="c1"># 422 valores</span>
<span class="n">diabetes_x_teste</span> <span class="o">=</span> <span class="n">diabetes_x</span><span class="p">[</span><span class="o">-</span><span class="mi">20</span><span class="p">:]</span> <span class="c1"># 20 valores</span>

<span class="c1"># resposta</span>
<span class="n">diabetes_y_treino</span> <span class="o">=</span> <span class="n">diabetes_y</span><span class="p">[:</span><span class="o">-</span><span class="mi">20</span><span class="p">]</span> <span class="c1"># 422 valores</span>
<span class="n">diabetes_y_teste</span> <span class="o">=</span> <span class="n">diabetes_y</span><span class="p">[</span><span class="o">-</span><span class="mi">20</span><span class="p">:]</span> <span class="c1"># 20 valores</span>

<span class="c1"># modelo de RL</span>
<span class="n">linregr</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">(</span><span class="n">fit_intercept</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># treinamento do modelo</span>
<span class="n">linregr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">diabetes_x_treino</span><span class="p">,</span><span class="n">diabetes_y_treino</span><span class="p">)</span>

<span class="c1"># predição</span>
<span class="n">diabetes_y_predicao</span> <span class="o">=</span> <span class="n">linregr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">diabetes_x_teste</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Agora, verificamos a qualidade do ajuste dos dados pela regressão linear.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># MSE</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">diabetes_y_teste</span><span class="p">,</span><span class="n">diabetes_y_predicao</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2548.0723987259703
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># R2</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">r2_score</span><span class="p">(</span><span class="n">diabetes_y_teste</span><span class="p">,</span> <span class="n">diabetes_y_predicao</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.47257544798227136
</pre></div>
</div>
</div>
</div>
<p>Uma plotagem gráfica simples nos dá a melhor reta de ajuste para os dados segundo o método de mínimos quadrados.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">diabetes_x_teste</span><span class="p">,</span><span class="n">diabetes_y_teste</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;#ad1c12&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">diabetes_x_teste</span><span class="p">,</span><span class="n">diabetes_y_predicao</span><span class="p">,</span><span class="s1">&#39;-k&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/13-regressao-rise_37_0.png" src="../_images/13-regressao-rise_37_0.png" />
</div>
</div>
<p>Uma vez que temos à disposição os coeficientes do ajuste, podemos predizer valores em locais desconhecidos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># slope, intercept</span>
<span class="n">m3</span><span class="p">,</span><span class="n">b3</span> <span class="o">=</span> <span class="n">linregr</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">linregr</span><span class="o">.</span><span class="n">intercept_</span>
<span class="nb">print</span><span class="p">((</span><span class="n">m3</span><span class="p">,</span><span class="n">b3</span><span class="p">))</span>

<span class="c1"># plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">diabetes_x_teste</span><span class="p">,</span><span class="n">diabetes_y_teste</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;#ad1c12&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">diabetes_x_teste</span><span class="p">,</span><span class="n">diabetes_y_predicao</span><span class="p">,</span><span class="s1">&#39;-k&#39;</span><span class="p">);</span>

<span class="c1"># estimativas</span>
<span class="n">x_est1</span><span class="p">,</span> <span class="n">x_est2</span><span class="p">,</span> <span class="n">x_est3</span> <span class="o">=</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.3</span>
<span class="n">p</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">m3</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">b3</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_est1</span><span class="p">,</span><span class="n">p</span><span class="p">(</span><span class="n">x_est1</span><span class="p">),</span><span class="s1">&#39;sg&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_est2</span><span class="p">,</span><span class="n">p</span><span class="p">(</span><span class="n">x_est2</span><span class="p">),</span><span class="s1">&#39;*b&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_est3</span><span class="p">,</span><span class="n">p</span><span class="p">(</span><span class="n">x_est3</span><span class="p">),</span><span class="s1">&#39;vm&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">10</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(938.2378612512633, 152.91886182616167)
</pre></div>
</div>
<img alt="../_images/13-regressao-rise_39_1.png" src="../_images/13-regressao-rise_39_1.png" />
</div>
</div>
<p>Comentários:</p>
<ul class="simple">
<li><p>Os 3 pontos são colineares. Ou seja, pertencem à reta.</p></li>
<li><p>O triângulo rosa seria considerado uma <em>extrapolação</em>, já que é uma estimativa feita muito “além do conhecido”. Ele segue a tendência linear, mas pode ser uma previsão bastante errônea.</p></li>
</ul>
</section>
</section>
<section id="regressao-multipla">
<h2>Regressão múltipla<a class="headerlink" href="#regressao-multipla" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Na regressão múltipla, há mais do que um preditor (covariante) envolvido.</p></li>
<li><p>Neste caso, em vez de uma reta, o modelo matemático é um <em>hiperplano</em>.</p></li>
<li><p>O <em>dataset</em> <span class="xref myst">Advertising.csv</span> contém informação sobre orçamentos destinados para anúncios em TV, rádio e jornal, bem como sobre o número de vendas em unidades não declaradas.</p></li>
<li><p>Objetivo da análise de regressão: saber como esses orçamentos influenciam a venda de produtos.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># importa statsmodels </span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># carrega dataset</span>
<span class="n">ad</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../database/Advertising.csv&#39;</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ad</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>TV</th>
      <th>Radio</th>
      <th>Newspaper</th>
      <th>Sales</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>230.1</td>
      <td>37.8</td>
      <td>69.2</td>
      <td>22.1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>44.5</td>
      <td>39.3</td>
      <td>45.1</td>
      <td>10.4</td>
    </tr>
    <tr>
      <th>3</th>
      <td>17.2</td>
      <td>45.9</td>
      <td>69.3</td>
      <td>9.3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>151.5</td>
      <td>41.3</td>
      <td>58.5</td>
      <td>18.5</td>
    </tr>
    <tr>
      <th>5</th>
      <td>180.8</td>
      <td>10.8</td>
      <td>58.4</td>
      <td>12.9</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Uma visão geral sobre a distribuição dos dados é obtida com a plotagem múltipla dos histogramas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># histogramas</span>
<span class="n">ad</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">15</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/13-regressao-rise_45_0.png" src="../_images/13-regressao-rise_45_0.png" />
</div>
</div>
<p>Realizamos a análise de regressão linear para verificar se poderíamos usar a variável <code class="docutils literal notranslate"><span class="pre">TV</span></code> para predizer as vendas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_ad</span> <span class="o">=</span> <span class="n">ad</span><span class="p">[</span><span class="s1">&#39;Sales&#39;</span><span class="p">]</span>
<span class="n">X_ad</span> <span class="o">=</span> <span class="n">ad</span><span class="p">[</span><span class="s1">&#39;TV&#39;</span><span class="p">]</span>
<span class="n">X_ad</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">X_ad</span><span class="p">)</span>
<span class="n">lr</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y_ad</span><span class="p">,</span><span class="n">X_ad</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">lr</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>          <td>Sales</td>      <th>  R-squared:         </th> <td>   0.612</td>
</tr>
<tr>
  <th>Model:</th>                   <td>OLS</td>       <th>  Adj. R-squared:    </th> <td>   0.610</td>
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th> <td>   312.1</td>
</tr>
<tr>
  <th>Date:</th>             <td>Wed, 13 Oct 2021</td> <th>  Prob (F-statistic):</th> <td>1.47e-42</td>
</tr>
<tr>
  <th>Time:</th>                 <td>11:46:31</td>     <th>  Log-Likelihood:    </th> <td> -519.05</td>
</tr>
<tr>
  <th>No. Observations:</th>      <td>   200</td>      <th>  AIC:               </th> <td>   1042.</td>
</tr>
<tr>
  <th>Df Residuals:</th>          <td>   198</td>      <th>  BIC:               </th> <td>   1049.</td>
</tr>
<tr>
  <th>Df Model:</th>              <td>     1</td>      <th>                     </th>     <td> </td>   
</tr>
<tr>
  <th>Covariance Type:</th>      <td>nonrobust</td>    <th>                     </th>     <td> </td>   
</tr>
</table>
<table class="simpletable">
<tr>
    <td></td>       <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>const</th> <td>    7.0326</td> <td>    0.458</td> <td>   15.360</td> <td> 0.000</td> <td>    6.130</td> <td>    7.935</td>
</tr>
<tr>
  <th>TV</th>    <td>    0.0475</td> <td>    0.003</td> <td>   17.668</td> <td> 0.000</td> <td>    0.042</td> <td>    0.053</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td> 0.531</td> <th>  Durbin-Watson:     </th> <td>   1.935</td>
</tr>
<tr>
  <th>Prob(Omnibus):</th> <td> 0.767</td> <th>  Jarque-Bera (JB):  </th> <td>   0.669</td>
</tr>
<tr>
  <th>Skew:</th>          <td>-0.089</td> <th>  Prob(JB):          </th> <td>   0.716</td>
</tr>
<tr>
  <th>Kurtosis:</th>      <td> 2.779</td> <th>  Cond. No.          </th> <td>    338.</td>
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># R^2</span>
<span class="n">lr</span><span class="o">.</span><span class="n">rsquared</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.611875050850071
</pre></div>
</div>
</div>
</div>
<p>Comentário:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(R^2 \approx 0.61\)</span> indica que cerca de 61% da variância na relação TV-vendas pode ser explicada pelo modelo <code class="docutils literal notranslate"><span class="pre">lr</span></code>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">ad</span><span class="p">[</span><span class="s1">&#39;TV&#39;</span><span class="p">],</span><span class="n">ad</span><span class="p">[</span><span class="s1">&#39;Sales&#39;</span><span class="p">]);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;TV&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Vendas&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/13-regressao-rise_50_0.png" src="../_images/13-regressao-rise_50_0.png" />
</div>
</div>
<p>Embora o valor de <span class="math notranslate nohighlight">\(R^2\)</span> seja razoável, vamos repetir a análise, mas agora com a variável <code class="docutils literal notranslate"><span class="pre">Radio</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_ad2</span> <span class="o">=</span> <span class="n">ad</span><span class="p">[</span><span class="s1">&#39;Sales&#39;</span><span class="p">]</span>
<span class="n">X_ad2</span> <span class="o">=</span> <span class="n">ad</span><span class="p">[</span><span class="s1">&#39;Radio&#39;</span><span class="p">]</span>
<span class="n">X_ad2</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">X_ad2</span><span class="p">)</span> 
<span class="n">lr2</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y_ad2</span><span class="p">,</span><span class="n">X_ad2</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">lr2</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>          <td>Sales</td>      <th>  R-squared:         </th> <td>   0.332</td>
</tr>
<tr>
  <th>Model:</th>                   <td>OLS</td>       <th>  Adj. R-squared:    </th> <td>   0.329</td>
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th> <td>   98.42</td>
</tr>
<tr>
  <th>Date:</th>             <td>Wed, 13 Oct 2021</td> <th>  Prob (F-statistic):</th> <td>4.35e-19</td>
</tr>
<tr>
  <th>Time:</th>                 <td>11:48:59</td>     <th>  Log-Likelihood:    </th> <td> -573.34</td>
</tr>
<tr>
  <th>No. Observations:</th>      <td>   200</td>      <th>  AIC:               </th> <td>   1151.</td>
</tr>
<tr>
  <th>Df Residuals:</th>          <td>   198</td>      <th>  BIC:               </th> <td>   1157.</td>
</tr>
<tr>
  <th>Df Model:</th>              <td>     1</td>      <th>                     </th>     <td> </td>   
</tr>
<tr>
  <th>Covariance Type:</th>      <td>nonrobust</td>    <th>                     </th>     <td> </td>   
</tr>
</table>
<table class="simpletable">
<tr>
    <td></td>       <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>const</th> <td>    9.3116</td> <td>    0.563</td> <td>   16.542</td> <td> 0.000</td> <td>    8.202</td> <td>   10.422</td>
</tr>
<tr>
  <th>Radio</th> <td>    0.2025</td> <td>    0.020</td> <td>    9.921</td> <td> 0.000</td> <td>    0.162</td> <td>    0.243</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td>19.358</td> <th>  Durbin-Watson:     </th> <td>   1.946</td>
</tr>
<tr>
  <th>Prob(Omnibus):</th> <td> 0.000</td> <th>  Jarque-Bera (JB):  </th> <td>  21.910</td>
</tr>
<tr>
  <th>Skew:</th>          <td>-0.764</td> <th>  Prob(JB):          </th> <td>1.75e-05</td>
</tr>
<tr>
  <th>Kurtosis:</th>      <td> 3.544</td> <th>  Cond. No.          </th> <td>    51.4</td>
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</div></div>
</div>
<p>Igualmente, podemos fazer um plot de dispersão.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">ad</span><span class="p">[</span><span class="s1">&#39;Radio&#39;</span><span class="p">],</span><span class="n">ad</span><span class="p">[</span><span class="s1">&#39;Sales&#39;</span><span class="p">]);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Rádio&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Vendas&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/13-regressao-rise_54_0.png" src="../_images/13-regressao-rise_54_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr2</span><span class="o">.</span><span class="n">rsquared</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.33203245544529525
</pre></div>
</div>
</div>
</div>
<p>Neste caso, o modelo retorna um valor de <span class="math notranslate nohighlight">\(R^2\)</span> pior do que o anterior. Este valor seria considerado “ruim”. Mas, e se ambos os preditores forem postos juntos no modelo?</p>
<p>Vejamos o que ocorre.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_ad3</span> <span class="o">=</span> <span class="n">ad</span><span class="p">[</span><span class="s1">&#39;Sales&#39;</span><span class="p">]</span>
<span class="n">X_ad3</span> <span class="o">=</span> <span class="n">ad</span><span class="p">[[</span><span class="s1">&#39;TV&#39;</span><span class="p">,</span><span class="s1">&#39;Radio&#39;</span><span class="p">]]</span>
<span class="n">X_ad3</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">X_ad3</span><span class="p">)</span>
<span class="n">lr3</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y_ad3</span><span class="p">,</span><span class="n">X_ad3</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span> 
<span class="n">lr3</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>          <td>Sales</td>      <th>  R-squared:         </th> <td>   0.897</td>
</tr>
<tr>
  <th>Model:</th>                   <td>OLS</td>       <th>  Adj. R-squared:    </th> <td>   0.896</td>
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th> <td>   859.6</td>
</tr>
<tr>
  <th>Date:</th>             <td>Wed, 13 Oct 2021</td> <th>  Prob (F-statistic):</th> <td>4.83e-98</td>
</tr>
<tr>
  <th>Time:</th>                 <td>11:50:08</td>     <th>  Log-Likelihood:    </th> <td> -386.20</td>
</tr>
<tr>
  <th>No. Observations:</th>      <td>   200</td>      <th>  AIC:               </th> <td>   778.4</td>
</tr>
<tr>
  <th>Df Residuals:</th>          <td>   197</td>      <th>  BIC:               </th> <td>   788.3</td>
</tr>
<tr>
  <th>Df Model:</th>              <td>     2</td>      <th>                     </th>     <td> </td>   
</tr>
<tr>
  <th>Covariance Type:</th>      <td>nonrobust</td>    <th>                     </th>     <td> </td>   
</tr>
</table>
<table class="simpletable">
<tr>
    <td></td>       <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>const</th> <td>    2.9211</td> <td>    0.294</td> <td>    9.919</td> <td> 0.000</td> <td>    2.340</td> <td>    3.502</td>
</tr>
<tr>
  <th>TV</th>    <td>    0.0458</td> <td>    0.001</td> <td>   32.909</td> <td> 0.000</td> <td>    0.043</td> <td>    0.048</td>
</tr>
<tr>
  <th>Radio</th> <td>    0.1880</td> <td>    0.008</td> <td>   23.382</td> <td> 0.000</td> <td>    0.172</td> <td>    0.204</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td>60.022</td> <th>  Durbin-Watson:     </th> <td>   2.081</td>
</tr>
<tr>
  <th>Prob(Omnibus):</th> <td> 0.000</td> <th>  Jarque-Bera (JB):  </th> <td> 148.679</td>
</tr>
<tr>
  <th>Skew:</th>          <td>-1.323</td> <th>  Prob(JB):          </th> <td>5.19e-33</td>
</tr>
<tr>
  <th>Kurtosis:</th>      <td> 6.292</td> <th>  Cond. No.          </th> <td>    425.</td>
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr3</span><span class="o">.</span><span class="n">rsquared</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.8971942610828956
</pre></div>
</div>
</div>
</div>
<p>Com ambos os preditores, o valor de <span class="math notranslate nohighlight">\(R^2\)</span> saltou para quase 90%, um número melhor! Assim, percebemos que a regressão múltipla resulta em um modelo mais acurado do que os modelos para regressão simples individuais.</p>
<p>Para ver o plano da regressão múltipla, devemos fazer uma plotagem tridimensional.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>

<span class="c1"># X e Y usando tamanhos de TV and Radio</span>
<span class="n">X_axis</span><span class="p">,</span> <span class="n">Y_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ad</span><span class="p">[</span><span class="s1">&#39;TV&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">ad</span><span class="p">[</span><span class="s1">&#39;TV&#39;</span><span class="p">]</span><span class="o">.</span> <span class="nb">max</span><span class="p">(),</span> <span class="mi">100</span><span class="p">),</span> 
                             <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ad</span><span class="p">[</span><span class="s1">&#39;Radio&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">ad</span><span class="p">[</span><span class="s1">&#39;Radio&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">100</span><span class="p">))</span>

<span class="c1"># equação do hiperplano calculando o eixo Z correspondente (Sales)</span>
<span class="c1"># z = a0 + a1x + a2y</span>
<span class="n">Z_axis</span> <span class="o">=</span> <span class="n">lr3</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">lr3</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">X_axis</span> <span class="o">+</span> <span class="n">lr3</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">Y_axis</span>

<span class="c1"># cria eixo 3D</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span> <span class="c1"># figsize refers to width and height of the figure</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">Axes3D</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">azim</span><span class="o">=-</span><span class="mi">50</span><span class="p">)</span>

<span class="c1"># plota o hiperplano</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X_axis</span><span class="p">,</span> <span class="n">Y_axis</span><span class="p">,</span> <span class="n">Z_axis</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">coolwarm</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># plota dispersão </span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">ad</span><span class="p">[</span><span class="s1">&#39;TV&#39;</span><span class="p">],</span> <span class="n">ad</span><span class="p">[</span><span class="s1">&#39;Radio&#39;</span><span class="p">],</span><span class="n">ad</span><span class="p">[</span><span class="s1">&#39;Sales&#39;</span><span class="p">])</span>

<span class="c1"># labels</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;TV&#39;</span><span class="p">);</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Rádio&#39;</span><span class="p">);</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;Vendas&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/13-regressao-rise_60_0.png" src="../_images/13-regressao-rise_60_0.png" />
</div>
</div>
<blockquote>
<div><p>A conclusão da última análise é que as vendas são, de fato, impulsionadas, se houver cada vez mais investimento em propaganda via rádio e televisão.</p>
</div></blockquote>
<section id="estimando-valores">
<h3>Estimando valores<a class="headerlink" href="#estimando-valores" title="Permalink to this headline">¶</a></h3>
<p>Digamos que, como um analista de mercado, você tem interesse em prever quanto atingiria em vendas investindo <span class="math notranslate nohighlight">\(t\)</span> e <span class="math notranslate nohighlight">\(r\)</span> unidades monetárias (p.ex. milhares de reais) em anúncios na TV e rádio, respectivamente.</p>
<p>Como fizemos na regressão simples, basta substituir valores na equação do plano e verificar a resposta.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">venda_pred</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">,</span><span class="n">r</span><span class="p">:</span> <span class="n">lr3</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">lr3</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">t</span> <span class="o">+</span> <span class="n">lr3</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">r</span>
<span class="n">venda_pred</span><span class="p">(</span><span class="mi">102</span><span class="p">,</span><span class="mi">31</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>13.415912077944483
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">venda_pred</span><span class="p">(</span><span class="mi">253</span><span class="p">,</span><span class="mi">44</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>22.768814104270994
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">venda_pred</span><span class="p">(</span><span class="mi">619</span><span class="p">,</span><span class="mi">101</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>50.23074734862246
</pre></div>
</div>
</div>
</div>
<p>Conforme a própria inclinação do plano mostra, à medida que aumentamos o investimento em ambos os canais de divulgação, as vendas aumentam.</p>
</section>
</section>
<section id="inspecao-de-multicolinearidade">
<h2>Inspeção de multicolinearidade<a class="headerlink" href="#inspecao-de-multicolinearidade" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>É possível inspecionar a relação entre variáveis (preditores) através de um <em>scatter matrix plot</em>.</p></li>
<li><p>Com a matriz dos gráficos de dispersão, verificamos a <em>multicolinearidade</em>, isto é se pares de variáveis se correlacionam de modo linear, ou não.</p></li>
</ul>
<section id="pandas-plotting-scatter-matrix">
<h3><code class="docutils literal notranslate"><span class="pre">pandas.plotting.scatter_matrix</span></code><a class="headerlink" href="#pandas-plotting-scatter-matrix" title="Permalink to this headline">¶</a></h3>
<p>Plota dispersões entre séries de um <em>DataFrame</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">plotting</span><span class="o">.</span><span class="n">scatter_matrix</span><span class="p">(</span><span class="n">ad</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span><span class="n">grid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span> <span class="n">ad</span><span class="p">[</span><span class="s1">&#39;Sales&#39;</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/13-regressao-rise_69_0.png" src="../_images/13-regressao-rise_69_0.png" />
</div>
</div>
</section>
<section id="seaborn-pairplot">
<h3><code class="docutils literal notranslate"><span class="pre">seaborn.pairplot</span></code><a class="headerlink" href="#seaborn-pairplot" title="Permalink to this headline">¶</a></h3>
<p>Faz o mesmo que a função anterior. Entretanto, há uma série de opções adicionais.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sb</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">ad</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/13-regressao-rise_71_0.png" src="../_images/13-regressao-rise_71_0.png" />
</div>
</div>
<p>Para incluir as retas de regressão, adicione <code class="docutils literal notranslate"><span class="pre">kind='reg'</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sb</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">ad</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;reg&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/13-regressao-rise_73_0.png" src="../_images/13-regressao-rise_73_0.png" />
</div>
</div>
</section>
<section id="seaborn-heatmap">
<h3><code class="docutils literal notranslate"><span class="pre">seaborn.heatmap</span></code><a class="headerlink" href="#seaborn-heatmap" title="Permalink to this headline">¶</a></h3>
<p>O <em>heat map</em> (mapa de calor) é uma matriz de cores útil para mostrar visualmente coeficientes de correlação entre duas variáveis. As cores quentes representam alta correlação; as frias, baixa correlação.</p>
<p>Podemos criar um mapa de calor para o <em>DataFrame</em> dos anúncios com a ajuda da função <code class="docutils literal notranslate"><span class="pre">pandas.corr()</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sb</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">ad</span><span class="o">.</span><span class="n">corr</span><span class="p">(),</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/13-regressao-rise_75_0.png" src="../_images/13-regressao-rise_75_0.png" />
</div>
</div>
<p>Comentários:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vmin</span></code> e <code class="docutils literal notranslate"><span class="pre">vmax</span></code> são limitantes para a escala de cores.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cmap</span></code> controla o mapa de cores. Para saber as opções possíveis, verifique <code class="docutils literal notranslate"><span class="pre">help(plt.colormaps)</span></code></p></li>
</ul>
</section>
</section>
<section id="exercicio-aplicado">
<h2>Exercício aplicado<a class="headerlink" href="#exercicio-aplicado" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Use a série <code class="docutils literal notranslate"><span class="pre">Newspaper</span></code> para criar um modelo de regressão múltipla com os três covariantes do <em>dataset</em> <a class="reference external" href="https://github.com/gcpeixoto/ICD/blob/main/database/Advertising.csv">Advertising.csv</a> e faça predições. Note que o seu hiperplano tem imagem real, mas pertence ao <span class="math notranslate nohighlight">\(\mathbb{R}^3\)</span>.</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "gcpeixoto/ICD",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./rise"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Gustavo Oliveira<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>